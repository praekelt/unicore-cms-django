{% extends "admin/change_form.html" %}
{% load admin_static i18n admin_modify admin_urls grp_tags %}


{% block stylesheets %}
{{ block.super }}
{% if original.source %}
<style type="text/css">
    .grp-change-form .grp-module:not(.grp-submit-row) {
        min-width: inherit; !important;
    }
    form:first-child{
        padding-right: 10px;
    }
    .translation form{
        width: 60%;
    }
    .source form{
        width: 38%;
        display: none;
    }
    form{
        float: left;
        clear: none !important;
    }
    .grp-row .vTextField{
        width: 100%;
    }
</style>
{% endif %}
{% endblock %}

{% block object-tools-items %}
    {{ block.super }}
    {% if has_add_permission %}
        {% url 'admin:cms_post_add' as add_url %}
        <li><a href="{% add_preserved_filters add_url %}?source={{object_id}}" class="addlink">{% trans "Translate" %}</a></li>
    {% endif %}
{% endblock %}


<!-- CONTENT -->
{% block content %}
    <div class="translation">
    {{ block.super }}
    </div>

    {% if original.source %}
    {% with adminform=sourceform %}
    <div class="source">
    <form {% if has_file_field %}enctype="multipart/form-data" {% endif %}action="{{ form_url }}" method="post" id="{{ opts.model_name }}_form">{% csrf_token %}{% block form_top %}{% endblock %}
        <div>
            <!-- Popup Hidden Field -->
            {% if is_popup %}<input type="hidden" name="_popup" value="1" />{% endif %}

            <!-- No Submit-Row on Top -->

            <!-- Errors -->
            {% if errors %}
                <p class="errornote">{% if errors|length == 1 %}{% trans "Please correct the error below." %}{% else %}{% trans "Please correct the errors below." %}{% endif %}</p>
                <ul class="errorlist">{% for error in adminform.form.non_field_errors %}<li>{{ error }}</li>{% endfor %}</ul>
            {% endif %}

            <!-- Fieldsets -->
            {% block field_sets %}
                {% for fieldset in adminform %}
                    {% include "admin/includes/fieldset.html" %}
                {% endfor %}
            {% endblock %}

            {% block after_field_sets %}{% endblock %}

            <!-- Inlines -->
            {% block inline_field_sets %}
                {% for inline_admin_formset in inline_admin_formsets %}
                    {% include inline_admin_formset.opts.template %}
                {% endfor %}
            {% endblock %}

            <!-- JS for prepopulated fields -->
            {% prepopulated_fields_js %}

            {% if original.source %}
            <script type="text/javascript" charset="utf-8">
            (function($) {
                $(document).ready(function() {
                    $('.source div.c-1').remove();
                    $('.source form input').attr('disabled', 'disabled').removeAttr('id').removeAttr('name'); //Disable
                    $('.source form textarea').attr('readonly', 'true').removeAttr('id').removeAttr('name'); //Disable
                    $('.source #id_primary_category').parent().html('<div class="c-2"><input type="text" disabled="disabled"value="{{original.source.primary_category.title}}"/></div>')
                    $('.source #id_language').parent().html('<div class="c-2"><input type="text" disabled="disabled"value="{{original.source.language}}"/></div>')
                    $('.source form').show();
                });
            })(grp.jQuery);
        </script>
            {% endif %}

        </div>
    </form>
    </div>
    {% endwith %}
    {% endif %}
{% endblock %}
